{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _Daily = _interopRequireDefault(require(\"./Daily\"));\n\nvar _jsxFileName = \"/Users/sooyoung/Projects/Planact/src/components/DailyList.tsx\";\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction DailyList(props) {\n  var _this = this;\n\n  var start = props.start,\n      end = props.end,\n      data = props.data,\n      loading = props.loading,\n      loader = props.loader,\n      selector = props.selector;\n\n  var _useState = (0, _react.useState)(start),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      currentStart = _useState2[0],\n      setCurrentStart = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(end),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      currentEnd = _useState4[0],\n      setCurrentEnd = _useState4[1];\n\n  var theme = (0, _reactRedux.useSelector)(function (state) {\n    return state;\n  });\n\n  var _useState5 = (0, _react.useState)([]),\n      _useState6 = (0, _slicedToArray2.default)(_useState5, 2),\n      dailylist = _useState6[0],\n      setDailyList = _useState6[1];\n\n  var getDailyBoxes = function getDailyBoxes(from, to) {\n    var diff = to.diff(from, 'days');\n    var filteredData = data.filter(function (_ref) {\n      var date = _ref.date;\n      return date >= from && date <= to;\n    });\n    var idx = 0;\n\n    for (var i = 0; i <= diff; i++) {\n      var date = from.add(i, 'days');\n\n      if (idx >= filteredData.length || filteredData[idx].date.format(\"YYYYMMDD\") != date.format(\"YYYYMMDD\")) {\n        filteredData.splice(idx, 0, {\n          date: date,\n          events: []\n        });\n      }\n\n      idx++;\n    }\n\n    return filteredData;\n  };\n\n  (0, _react.useEffect)(function () {\n    if (loading) return;\n    var list = getDailyBoxes(start, end);\n    setDailyList(list);\n    setCurrentStart(start);\n    setCurrentEnd(end);\n  }, [loading]);\n  (0, _react.useEffect)(function () {\n    if (start >= currentStart) return;\n    var newDailylist = getDailyBoxes(start, currentStart.subtract(1, 'day'));\n    setDailyList(function (prev) {\n      return newDailylist.concat(prev);\n    });\n    setCurrentStart(start);\n  }, [start]);\n  (0, _react.useEffect)(function () {\n    if (currentEnd >= end || currentStart == currentEnd) return;\n    var newDailylist = getDailyBoxes(currentEnd.add(1, 'day'), end);\n    setDailyList(function (prev) {\n      return prev.concat(newDailylist);\n    });\n    setCurrentEnd(end);\n  }, [end]);\n\n  var _useState7 = (0, _react.useState)(0),\n      _useState8 = (0, _slicedToArray2.default)(_useState7, 2),\n      contentSize = _useState8[0],\n      setContentSize = _useState8[1];\n\n  var getData = function getData(props) {\n    var x;\n    return _regenerator.default.async(function getData$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!loading) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            x = props.nativeEvent.contentOffset.x;\n            if (x < 0) loader(false);else if (contentSize - x < 300) loader(true);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var renderItem = function renderItem(props) {\n    if (loading) return _react.default.createElement(_react.default.Fragment, null);\n\n    var onPress = function onPress() {\n      return selector(props.index);\n    };\n\n    return _react.default.createElement(_Daily.default, (0, _extends2.default)({\n      onPress: onPress\n    }, props.item, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 13\n      }\n    }));\n  };\n\n  return _react.default.createElement(_reactNative.FlatList, {\n    onScrollEndDrag: getData,\n    onContentSizeChange: setContentSize,\n    horizontal: true,\n    showsHorizontalScrollIndicator: true,\n    initialNumToRender: 7,\n    style: styles(theme).scroll,\n    data: dailylist,\n    keyExtractor: function keyExtractor(item) {\n      return String(item.date.format(\"YYYYMMDD\"));\n    },\n    renderItem: renderItem,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  });\n}\n\nvar styles = function styles(theme) {\n  return _reactNative.StyleSheet.create({\n    scroll: {\n      flex: 1,\n      padding: 5,\n      paddingVertical: 10,\n      backgroundColor: \"#fafafa\"\n    }\n  });\n};\n\nvar _default = DailyList;\nexports.default = _default;","map":{"version":3,"sources":["/Users/sooyoung/Projects/Planact/src/components/DailyList.tsx"],"names":["DailyList","props","start","end","data","loading","loader","selector","currentStart","setCurrentStart","currentEnd","setCurrentEnd","theme","state","dailylist","setDailyList","getDailyBoxes","from","to","diff","filteredData","filter","date","idx","i","add","length","format","splice","events","list","newDailylist","subtract","prev","concat","contentSize","setContentSize","getData","x","nativeEvent","contentOffset","renderItem","onPress","index","item","styles","scroll","String","StyleSheet","create","flex","padding","paddingVertical","backgroundColor"],"mappings":"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","sourcesContent":["import { GlobalState } from \"@/../App\";\nimport { IDailyList, IDaily } from \"@/utils/data\";\nimport { Dayjs } from \"dayjs\";\nimport React from \"react\";\nimport { useRef } from \"react\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { Dimensions, FlatList, StyleSheet } from \"react-native\";\nimport { useSelector } from \"react-redux\";\nimport { DefaultTheme } from \"styled-components/native\";\nimport Daily from \"./Daily\";\n\ninterface DailyListProps extends IDailyList {\n    loading: Boolean;\n    selector: (index:number) => void;\n    loader: (after:boolean) => Promise<void>;\n}\nfunction DailyList(props: DailyListProps){\n    const {start, end, data, loading, loader, selector} = props;\n    const [currentStart, setCurrentStart] = useState<Dayjs>(start);\n    const [currentEnd, setCurrentEnd] = useState<Dayjs>(end);\n    const theme = useSelector((state:GlobalState) => state);\n    \n    // 최적화 필요!!!\n    const [dailylist, setDailyList] = useState<IDaily[]>([]);\n    // 추가할 Daily Box의 배열\n    const getDailyBoxes = (from:Dayjs, to:Dayjs):IDaily[] => {\n        const diff = to.diff(from, 'days');\n        const filteredData = data.filter(({date}:IDaily) => date >= from && date <= to);\n        let idx = 0;\n        for(let i = 0; i<=diff; i++){\n            const date = from.add(i, 'days');\n            if(idx >= filteredData.length || \n                filteredData[idx].date.format(\"YYYYMMDD\") != date.format(\"YYYYMMDD\")){\n                filteredData.splice(idx, 0, {\n                    date,\n                    events: []\n                })\n            }\n            idx++;\n        }\n        return filteredData;\n    }\n\n    useEffect(() => {\n        if(loading) return;\n        let list:IDaily[] = getDailyBoxes(start, end);\n        setDailyList(list);\n        setCurrentStart(start);\n        setCurrentEnd(end);\n    }, [loading])\n\n    useEffect(() => {\n        if(start >= currentStart)\n            return;\n        let newDailylist:IDaily[] = getDailyBoxes(start, currentStart.subtract(1, 'day'))\n        setDailyList( prev => newDailylist.concat(prev))\n        setCurrentStart(start);\n    }, [start])\n\n    useEffect(() => {\n        if(currentEnd >= end || currentStart == currentEnd)\n            return;\n        let newDailylist:IDaily[] = getDailyBoxes(currentEnd.add(1, 'day'), end);\n        setDailyList( prev => prev.concat(newDailylist));\n        setCurrentEnd(end);\n    }, [end])\n\n    const [contentSize, setContentSize] = useState<number>(0);\n    const getData = async (props:any) => {\n        if(loading) return;\n        // loader(true);\n\n        const x = props.nativeEvent.contentOffset.x;\n        if(x < 0)\n            loader(false);\n        else if(contentSize - x < 300)\n            loader(true);\n    }\n    const renderItem = (props:any) => {\n        if(loading) return <></>;\n        const onPress = () => selector(props.index)\n        return (\n            <Daily \n                onPress={onPress}\n                {...props.item} \n            />)\n    }\n\n    return(\n        <FlatList\n            onScrollEndDrag={getData}\n            onContentSizeChange={setContentSize}\n            horizontal\n            showsHorizontalScrollIndicator\n            initialNumToRender={7}\n            style={styles(theme).scroll}\n            data={dailylist}\n            keyExtractor={(item) => String(item.date.format(\"YYYYMMDD\") )}\n            renderItem={renderItem}\n            />\n    )\n}\n\n\nconst styles = (theme:DefaultTheme) => {\n    return StyleSheet.create({\n        scroll:{\n            flex: 1,\n            padding: 5,\n            paddingVertical: 10,\n            backgroundColor: \"#fafafa\",\n        },\n    })\n}\n\n\nexport default DailyList;"]},"metadata":{},"sourceType":"script"}